<!-- <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Record and Save Video</title>
</head>
<body>
<div>
  <button type="button" id="buttonStart">Start</button>
  <button type="button" id="buttonStop" disabled>Stop</button>
</div>
<div>
  <video autoplay muted playsinline id="videoLive"></video>
</div>
<div>
  <video controls playsinline id="videoRecorded"></video>
</div>
<script>
  async function main() {
    const buttonStart = document.querySelector('#buttonStart');
    const buttonStop = document.querySelector('#buttonStop');
    const videoLive = document.querySelector('#videoLive');
    const videoRecorded = document.querySelector('#videoRecorded');
    let recordedChunks = [];

    const stream = await navigator.mediaDevices.getUserMedia({
      video: true,
      audio: true,
    });

    videoLive.srcObject = stream;

    if (!MediaRecorder.isTypeSupported('video/webm')) {
      console.warn('video/webm is not supported');
    }

    const mediaRecorder = new MediaRecorder(stream, {
      mimeType: 'video/webm',
    });

    buttonStart.addEventListener('click', () => {
      mediaRecorder.start();
      buttonStart.setAttribute('disabled', '');
      buttonStop.removeAttribute('disabled');
    });

    buttonStop.addEventListener('click', () => {
      mediaRecorder.stop();
      buttonStart.removeAttribute('disabled');
      buttonStop.setAttribute('disabled', '');
    });

    mediaRecorder.addEventListener('dataavailable', event => {
      recordedChunks.push(event.data);
      videoRecorded.src = URL.createObjectURL(event.data);
    });

    mediaRecorder.addEventListener('stop', () => {
      const blob = new Blob(recordedChunks, { type: 'video/webm' });
      const formData = new FormData();
      formData.append('video', blob, 'recorded_video.webm');

      fetch('/save_video', {
        method: 'POST',
        body: formData,
      })
      .then(response => response.json())
      .then(data => console.log('Video saved:', data))
      .catch(error => console.error('Error saving video:', error));

      recordedChunks = [];
    });
  }

  main();
</script>
</body>
</html> -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Record and Save Video</title>
</head>
<body>
<div>
  <button type="button" id="buttonStart">Start</button>
  <button type="button" id="buttonStop" disabled>Stop</button>
</div>
<div>
  <video autoplay muted playsinline id="videoLive"></video>
</div>
<div>
  <video controls playsinline id="videoRecorded"></video>
</div>
<script>
  async function main() {
    const buttonStart = document.querySelector('#buttonStart');
    const buttonStop = document.querySelector('#buttonStop');
    const videoLive = document.querySelector('#videoLive');
    const videoRecorded = document.querySelector('#videoRecorded');
    let recordedChunks = [];

    const stream = await navigator.mediaDevices.getUserMedia({
      video: true,
      audio: true,
    });

    videoLive.srcObject = stream;

    if (!MediaRecorder.isTypeSupported('video/webm')) {
      console.warn('video/webm is not supported');
    }

    const mediaRecorder = new MediaRecorder(stream, {
      mimeType: 'video/webm',
    });

    buttonStart.addEventListener('click', () => {
      mediaRecorder.start();
      buttonStart.setAttribute('disabled', '');
      buttonStop.removeAttribute('disabled');
    });

    buttonStop.addEventListener('click', () => {
      mediaRecorder.stop();
      buttonStart.removeAttribute('disabled');
      buttonStop.setAttribute('disabled', '');
    });

    mediaRecorder.addEventListener('dataavailable', event => {
      recordedChunks.push(event.data);
      videoRecorded.src = URL.createObjectURL(event.data);
    });

    mediaRecorder.addEventListener('stop', () => {
      const blob = new Blob(recordedChunks, { type: 'video/webm' });
      const formData = new FormData();
      formData.append('video', blob, 'recorded_video.webm');

      fetch('/save_video', {
        method: 'POST',
        body: formData,
      })
      .then(response => response.json())
      .then(data => console.log('Video saved:', data))
      .catch(error => console.error('Error saving video:', error));

      recordedChunks = [];
    });
  }

  main();
</script>
</body>
</html>
